# Структура Excel файлов

## Общие требования

- Формат файла: `.xlsx` (Excel 2007+)
- Данные должны находиться на **первом листе** книги
- Поиск параметров выполняется по **тексту в ячейках** (нечувствителен к регистру)

## Извлекаемые параметры

### Параметры проекта

Бот ищет следующие параметры по ключевым словам в ячейках:

| Параметр | Ключевые слова для поиска | Единица измерения |
|----------|---------------------------|-------------------|
| Тип проекта | "проект" | Текст |
| Стоимость строительства (CAPEX) | "стоимость строительства", "capex", "капитальные затраты", "инвестиции" | млн руб |
| Срок строительства | "срок строительства", "период строительства", "длительность строительства" | лет |
| Доля долга | "доля долга", "процент долга", "доля заемных средств" | % |
| Ставка по долгу | "ставка по долгу", "процент по долгу", "ставка займа" | % |
| Ставка дисконтирования | "ставка дисконтирования", "дисконт", "ставка дисконта" | % |

### Результаты финансовой модели

| Параметр | Ключевые слова для поиска | Единица измерения |
|----------|---------------------------|-------------------|
| NPV | "npv", "чистая приведенная стоимость", "чистый приведенный доход" | млн руб |
| IRR | "irr", "внутренняя норма доходности", "внутренняя норма рентабельности" | % |
| Срок окупаемости | "срок окупаемости", "период окупаемости", "payback" | лет |

## Алгоритм поиска

1. Бот сканирует все ячейки первого листа
2. Ищет ячейки, содержащие ключевые слова (нечувствительно к регистру)
3. Извлекает числовое значение из соседних ячеек (справа или снизу от найденной)
4. Если параметр не найден, используется значение по умолчанию (0 или "Не указан")

## Пример структуры файла

```
| Параметр                    | Значение | Единица измерения |
|----------------------------|----------|-------------------|
| Тип проекта                | Метро    |                   |
| Стоимость строительства    | 500      | млн руб           |
| Срок строительства         | 3        | лет                |
| Доля долга                 | 30       | %                  |
| Ставка по долгу            | 20       | %                  |
| Ставка дисконтирования     | 25       | %                  |
|                             |          |                   |
| NPV                        | 152      | млн руб            |
| IRR                        | 30       | %                  |
| Срок окупаемости           | 6        | лет                |
```

## Обязательные данные

Для успешной обработки файл **должен содержать**:
- NPV (чистая приведенная стоимость)
- IRR (внутренняя норма доходности)
- Срок окупаемости

Если эти данные отсутствуют, бот вернет ошибку:
```
Ошибка: в файле не найдены необходимые данные (NPV, IRR). Проверьте структуру файла.
```

## Формат выходного файла

Бот создает новый лист `Анализ_рисков` в исходном файле и сохраняет результат как `[имя_файла]_анализ.xlsx`.

### Структура листа "Анализ_рисков"

1. **Заголовок**: "Результат анализа рисков проекта"

2. **Секция 1: Ключевые показатели**
   - Таблица с извлеченными параметрами проекта и результатами модели

3. **Секция 2: Заключение ИИ**
   - Уровень риска (с цветовой индикацией)
   - Обоснование оценки
   - Критические факторы

4. **Секция 3: Анализ непредвиденных ситуаций**
   - Таблица сценариев с оценкой влияния на NPV и IRR
   - Вероятность наступления
   - Потенциальные убытки

5. **Секция 4: Суммарные потенциальные убытки**
   - Общая оценка потенциальных потерь

6. **Секция 5: Рекомендации по снижению рисков**
   - Список рекомендаций от ИИ

## Обработка ошибок

### Неверный формат файла
```
Ошибка: поддерживаются только файлы Excel с расширением .xlsx
```

### Поврежденный файл
```
Ошибка: не удалось прочитать файл. Убедитесь, что файл не поврежден.
```

### Отсутствие данных
```
Ошибка: в файле не найдены необходимые данные (NPV, IRR). Проверьте структуру файла.
```

## Рекомендации по подготовке файла

1. Используйте понятные названия параметров (см. таблицу ключевых слов)
2. Размещайте значения рядом с названиями параметров
3. Убедитесь, что числовые значения действительно являются числами (не текстом)
4. Проверьте, что файл не защищен паролем
5. Убедитесь, что данные находятся на первом листе

## Примеры поддерживаемых форматов

Бот поддерживает различные варианты расположения данных:

**Вариант 1: Вертикальная таблица**
```
Параметр | Значение
---------|---------
CAPEX    | 500
```

**Вариант 2: Горизонтальная таблица**
```
Параметр: CAPEX
Значение: 500
```

**Вариант 3: Смешанный формат**
```
Стоимость строительства (CAPEX): 500 млн руб
```

Бот найдет данные в любом из этих форматов, если используются правильные ключевые слова.

