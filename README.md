# RiskAnalyzerBot

Telegram-бот для автоматизации первичного качественного анализа рисков инфраструктурных инвестиционных проектов.

## Описание

Бот принимает финансовую модель проекта в формате Excel (.xlsx), извлекает ключевые параметры и результаты модели, отправляет их на кастомное API ИИ-сервиса для анализа, получает структурированную оценку рисков и возвращает пользователю модифицированный Excel-файл с новым листом `Анализ_рисков`, содержащим сводку и выводы ИИ.

## Возможности

- ✅ Автоматическое извлечение параметров проекта из Excel
- ✅ Анализ рисков с помощью ИИ-сервиса
- ✅ Расчет влияния непредвиденных ситуаций (сценарийный анализ)
- ✅ Генерация детального отчета в Excel
- ✅ Fallback механизм при недоступности API
- ✅ Детальное логирование всех операций

## Требования

- Python 3.10+
- Telegram Bot Token
- Доступ к API ИИ-сервиса (FastAPI)

## Установка

1. Клонируйте репозиторий:
```bash
git clone https://github.com/ArsenShkryabin/analyzer-bot-.git
cd analyzer-bot-
```

2. Создайте виртуальное окружение:
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# или
venv\Scripts\activate  # Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

4. Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

5. Заполните `.env` файл (откройте `.env` и замените значения):
```ini
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
AI_API_URL=https://your-api-service.com/v1/chat/completions
AI_API_KEY=your_api_key_here
AI_MODEL=gpt-4o
LOG_LEVEL=INFO
TEMP_FILE_PATH=./temp_files
API_TIMEOUT=180
```

## Запуск

```bash
python main.py
```

## Использование

1. Найдите бота в Telegram: `@YourBotName`
2. Отправьте команду `/start`
3. Отправьте файл Excel (.xlsx) с финансовой моделью проекта
4. Дождитесь обработки (обычно 1-3 минуты)
5. Получите файл с результатами анализа

## Структура проекта

```
risk_analyzer_bot/
├── main.py                 # Точка входа
├── config.py               # Конфигурация
├── logger.py               # Настройка логирования
├── handlers/               # Обработчики Telegram
├── processors/             # Бизнес-логика
├── utils/                  # Вспомогательные утилиты
├── docs/                   # Документация
└── temp_files/             # Временные файлы
```

## Формат входных данных

Excel файл должен содержать на первом листе следующие данные (поиск выполняется по тексту в ячейках):

**Параметры проекта:**
- Тип проекта
- Стоимость строительства (CAPEX), млн руб
- Срок строительства, лет
- Доля долга, %
- Ставка по долгу, %
- Ставка дисконтирования, %

**Результаты модели:**
- NPV (чистая приведенная стоимость), млн руб
- IRR (внутренняя норма доходности), %
- Срок окупаемости, лет

## Формат выходных данных

Бот создает новый лист `Анализ_рисков` в исходном файле, содержащий:

1. **Ключевые показатели проекта** - таблица с извлеченными параметрами
2. **Заключение ИИ** - уровень риска, обоснование, критические факторы
3. **Анализ непредвиденных ситуаций** - таблица сценариев с оценкой влияния
4. **Суммарные потенциальные убытки**
5. **Рекомендации по снижению рисков**

## Логирование

Все операции логируются в консоль с форматом:
```
[ВРЕМЯ] [УРОВЕНЬ] [МОДУЛЬ] - СООБЩЕНИЕ (UserID: ...)
```

Уровень логирования настраивается через переменную `LOG_LEVEL` в `.env`.

## Обработка ошибок

Бот обрабатывает следующие типы ошибок:
- Неверный формат файла
- Поврежденный файл
- Отсутствие необходимых данных
- Недоступность API ИИ-сервиса (используется fallback)
- Ошибки генерации отчета

Все ошибки логируются с полным traceback.

## Разработка

Подробная документация доступна в директории `docs/`:
- `architecture.md` - Архитектура проекта
- `api_integration.md` - Интеграция с API
- `excel_structure.md` - Структура Excel файлов

## Лицензия

[Укажите лицензию]

## Контакты

[Укажите контакты]

